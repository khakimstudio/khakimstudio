<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Aplikasi Kasir Profesional</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body {
      margin: 0;
      font-family: 'Inter', sans-serif;
      background-color: #f4f6f8;
      color: #333;
    }
    .container {
      max-width: 700px;
      margin: auto;
      padding: 30px 20px;
    }
    h1 {
      text-align: center;
      color: #2c3e50;
    }
    .form-group {
      margin-bottom: 20px;
      position: relative;
    }
    input[type="text"], input[type="number"] {
      width: 100%;
      padding: 12px;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 16px;
      box-sizing: border-box;
    }
    ul.autocomplete {
      list-style-type: none;
      margin: 0;
      padding: 0;
      background: white;
      border: 1px solid #ccc;
      border-top: none;
      max-height: 180px;
      overflow-y: auto;
      position: absolute;
      width: 100%;
      z-index: 10;
    }
    ul.autocomplete li {
      padding: 10px;
      cursor: pointer;
    }
    ul.autocomplete li:hover {
      background-color: #f1f1f1;
    }
    .info-box, .rekap-box {
      padding: 12px;
      background: #e3f2fd;
      border: 1px solid #90caf9;
      border-radius: 6px;
      margin-bottom: 20px;
    }
    button {
      padding: 12px 20px;
      background: #007bff;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 16px;
      cursor: pointer;
      margin-right: 10px;
    }
    button:hover {
      background: #0056b3;
    }
    .total-box {
      margin-top: 20px;
      font-weight: bold;
      font-size: 18px;
      color: #2e7d32;
    }
  </style>
</head>
<body>
<div class="container">
  <h1>Kasir Toko</h1>

  <div class="form-group">
    <label for="namaBarang">Cari Nama Barang</label>
    <input type="text" id="namaBarang" placeholder="Ketik nama barang..." onkeyup="cariBarang()" autocomplete="off">
    <ul id="listDropdown" class="autocomplete"></ul>
  </div>

  <div class="form-group">
    <label for="jumlah">Jumlah Pembelian</label>
    <input type="number" id="jumlah" placeholder="Masukkan jumlah" min="1">
  </div>

  <div class="info-box" id="infoBarang" style="display: none;"></div>

  <button onclick="tambahRekap()">Tambah ke Rekap</button>
  <button onclick="unduhExcel()">Download Rekap Excel</button>
  <button onclick="cetakStruk()">Cetak Struk</button>

  <div class="rekap-box" id="rekapTransaksi" style="display: none;"></div>
  <div class="total-box" id="totalHarga" style="display: none;"></div>
</div>

<script>
  const barangList = [
    { kode: 'A-001', nama: 'Piring', stok: 15, harga: 5000 },
    { kode: 'A-002', nama: 'Sendok', stok: 6, harga: 2000 },
    { kode: 'A-003', nama: 'Gelas', stok: 46, harga: 4000 },
    { kode: 'A-004', nama: 'Garpu', stok: 20, harga: 2500 },
    { kode: 'A-005', nama: 'Mangkok', stok: 15, harga: 3500 },
    { kode: 'A-006', nama: 'Panci', stok: 16, harga: 50000 },
    { kode: 'A-007', nama: 'Pot', stok: 25, harga: 60000 },
    { kode: 'A-008', nama: 'Rice Cooker', stok: 50, harga: 300000 },
    { kode: 'A-009', nama: 'Pisau Dapur', stok: 14, harga: 15000 },
    { kode: 'A-010', nama: 'Mie Instan', stok: 16, harga: 3000 }
  ];

  let selectedBarang = null;
  const rekapList = [];

  function cariBarang() {
    const input = document.getElementById("namaBarang");
    const filter = input.value.toLowerCase();
    const dropdown = document.getElementById("listDropdown");
    const infoBox = document.getElementById("infoBarang");
    dropdown.innerHTML = "";
    infoBox.style.display = "none";
    selectedBarang = null;

    if (!filter) return;

    const hasil = barangList.filter(barang =>
      barang.nama.toLowerCase().includes(filter)
    );

    hasil.forEach(barang => {
      const li = document.createElement("li");
      li.textContent = barang.nama;
      li.onclick = () => pilihBarang(barang);
      dropdown.appendChild(li);
    });
  }

  function pilihBarang(barang) {
    document.getElementById("namaBarang").value = barang.nama;
    document.getElementById("listDropdown").innerHTML = "";
    const info = `
      <strong>Kode:</strong> ${barang.kode}<br>
      <strong>Nama:</strong> ${barang.nama}<br>
      <strong>Stok:</strong> ${barang.stok}<br>
      <strong>Harga:</strong> Rp ${barang.harga.toLocaleString()}
    `;
    const infoBox = document.getElementById("infoBarang");
    infoBox.innerHTML = info;
    infoBox.style.display = "block";
    selectedBarang = barang;
  }

  function tambahRekap() {
    const jumlah = parseInt(document.getElementById("jumlah").value);
    if (!selectedBarang || isNaN(jumlah) || jumlah <= 0) {
      alert("Pilih barang dan masukkan jumlah yang valid.");
      return;
    }

    rekapList.push({ ...selectedBarang, jumlah });
    tampilkanRekap();

    document.getElementById("namaBarang").value = "";
    document.getElementById("jumlah").value = "";
    document.getElementById("infoBarang").style.display = "none";
    selectedBarang = null;
  }

  function tampilkanRekap() {
    const box = document.getElementById("rekapTransaksi");
    const totalBox = document.getElementById("totalHarga");
    let total = 0;
    box.innerHTML = '<h3>Rekap Transaksi</h3>' + rekapList.map(item => {
      const subtotal = item.harga * item.jumlah;
      total += subtotal;
      return `<div><strong>${item.nama}</strong> (${item.kode}) - ${item.jumlah} pcs x Rp ${item.harga.toLocaleString()} = Rp ${subtotal.toLocaleString()}</div>`;
    }).join("");
    box.style.display = "block";
    totalBox.innerHTML = `Total Harga: Rp ${total.toLocaleString()}`;
    totalBox.style.display = "block";
  }

  function unduhExcel() {
    let csvContent = "data:text/csv;charset=utf-8,Kode,Nama Barang,Jumlah,Harga Satuan,Subtotal\n";
    rekapList.forEach(item => {
      const subtotal = item.harga * item.jumlah;
      csvContent += `${item.kode},${item.nama},${item.jumlah},${item.harga},${subtotal}\n`;
    });

    const encodedUri = encodeURI(csvContent);
    const link = document.createElement("a");
    link.setAttribute("href", encodedUri);
    link.setAttribute("download", "rekap_transaksi.csv");
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
  }

  function cetakStruk() {
    let struk = "=== STRUK PEMBELIAN ===\n";
    let total = 0;
    rekapList.forEach(item => {
      const subtotal = item.harga * item.jumlah;
      total += subtotal;
      struk += `${item.nama} (${item.jumlah} x Rp ${item.harga.toLocaleString()}) = Rp ${subtotal.toLocaleString()}\n`;
    });
    struk += `\nTOTAL: Rp ${total.toLocaleString()}\n\nTerima kasih!`;
    alert(struk);
  }
</script>
</body>
</html>
